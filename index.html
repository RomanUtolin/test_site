<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROMAN TEST SITE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ROMAN TEST SITE">
    <meta name="author" content="ROMAN TEST SITE">

    <!-- GA4: вставьте свой Measurement ID -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JPVF25WTR1"></script>
    <script>
        // Конфиденциальность (опционально, базовый Consent Mode V2)
        // Установите нужные вам дефолты до загрузки GA
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        // При желании включите debug: gtag('config', 'G-XXXXXXXXXX', { 'debug_mode': true });
        gtag('consent', 'default', {
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'ad_storage': 'granted',
            'analytics_storage': 'granted'   // измерение работает, реклама — отключена
        });
        gtag('js', new Date());
        gtag('config', 'G-JPVF25WTR1');
    </script>

    <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase-messaging.js"></script>
    <script type="text/javascript" src="ak-push.js"></script>
    <link rel="manifest" href="manifest.json"></link>
</head>

<body>
<div class="container">
    <h1>Добро пожаловать!</h1>
    <p>PUSH-уведомление:</p>
    <input type="text" id="nameInput" placeholder="Ваше имя">

    <!-- Кнопка подписки -->
    <button type="button" id="init_sub">PUSH - подписка</button>

    <script>
        document.getElementById('init_sub').addEventListener('click', () => {
            const email = document.getElementById('nameInput').value.trim() + '_ex@example.com';
            new AKPush().initSubscription({email: email})

            // GA4 событие о клике/подписке
            // event_name: 'push_subscribed' (кастомное), параметры — по вашему ТЗ
            gtag('event', 'push_subscribed', {
                event_category: 'push',
                event_label: 'init_subscription_click',
                email: email,            // хранить email в аналитике обычно не рекомендуется (PII).
                                         // Лучше хэш (SHA256) или вовсе убрать поле, если политиками запрещено.
                // пример безопаснее:
                // email_sha256: sha256(email) // если заранее хэшируете на бэке/в коде
            });
        });
    </script>
</div>
</body>
</html>